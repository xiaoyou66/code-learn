## find简介

查询所有的文档可以使用下面的命令

```shell
db.test.find({})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "like" : []
}
```

如果想查询特定内容，比如name为小游的文档

```shell
db.test.find({"name":"小游"})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "like" : []
}
```

### 返回指定的键

如果我们只需要name字段，我们可以这样，默认_id会返回，我们可以置为0，避免返回

```shell
db.test.find({},{"name":1,"_id":0})
/* 1 */
{
    "name" : "小游"
}
```

### 限制

查询文档的值必须是常量，也就是不能引用文档中其他键的值。

## 查询条件

### 查询条件

![image-20210513153123744](https://img.xiaoyou66.com/2021/05/13/0f6759a0abb9b.png)

```shell
db.test.find({"age":{"$gte":18,"$lte":30}})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : []
}
```

### OR查询

我们可以使用  `"$in"` 来查询一个键的多个值。也可以使用 `"$OR"` 一般来说OR会通用一些。

```shell
db.test.find({"age":{"$in":[20,100]}})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : []
}

/* 2 */
{
    "_id" : ObjectId("609cd4df71a920015b3da7ac"),
    "name" : "张三",
    "age" : 100,
    "like" : []
}
```

与 `$in` 相对的是 `$nin` ，会返回不匹配的文档。但是这个只能查询单个条件，下面我们来使用 or 查询年龄在20或者名字为张三的人

```shell
db.test.find({"$or":[{"age":{"$in":[20]}},{"name":"张三"}]})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : []
}

/* 2 */
{
    "_id" : ObjectId("609cd4df71a920015b3da7ac"),
    "name" : "张三",
    "age" : 100,
    "like" : []
}
```

### $NOT

这个是原语句，可以用在其他任何条件上

```shell
db.test.find({"age":{"$not":{"$in":[20]}}})
/* 1 */
{
    "_id" : ObjectId("609cd4df71a920015b3da7ac"),
    "name" : "张三",
    "age" : 100,
    "like" : []
}
```

### 条件句的规则

条件句是内层文档的键，修改器是外层文档的键

```shell
# 内层文档
db.test.find({"age":{"$not":{"$in":[20]}}})
# 外层文档
db.test.update({"name":"小游"},{"$set":{"age":0}})
```

![image-20210513154226719](https://img.xiaoyou66.com/2021/05/13/2cb89b8e1ce03.png)

## 特定类型的查询

### null

![image-20210513154325317](https://img.xiaoyou66.com/2021/05/13/4fa68e70d294b.png)

![image-20210513154334442](https://img.xiaoyou66.com/2021/05/13/1a64eadb4dcb8.png)

### 正则表达式

查询条件可以直接设置为正则表达式，用于灵活有效的匹配字符串

```shell
db.test.find({"name":/小/i})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : []
}
```

### 查询数组

```shell
db.test.find({"like":"看番"})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : [ 
        "写代码", 
        "看番"
    ]
}
```

如果想匹配多个数组，可以使用 `$all` 来进行匹配，里面的内容是没有顺序的

```shell
db.test.find({"like": {"$all":["写代码","看番"]}})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : [ 
        "写代码", 
        "看番"
    ]
}
# 下面这个语句匹配不到内容
db.test.find({"like": {"$all":["写代码","看番","玩"]}})
```

如果想查询指定长度的数组，可以使用 `$size`

```shell
db.test.find({"like": {"$size":2}})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : [ 
        "写代码", 
        "看番"
    ]
}
```

如果只想返回数组的前一个元素，可以使用 `$slice` 操作符，当然也可以知道偏移值

```shell
db.test.find({"name":"小游"},{"like":{"$slice":1}})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : [ 
        "写代码"
    ]
}

# 使用偏移值,跳过前一个元素，返回一个元素
db.test.find({"name":"小游"},{"like":{"$slice":[1,1]}})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : [ 
        "看番"
    ]
}
```

### 查询内嵌文档

```shell
db.test.find({"name.first":"小"})
/* 1 */
{
    "_id" : ObjectId("609cd4df71a920015b3da7ac"),
    "name" : {
        "first" : "小",
        "last" : "游"
    },
    "age" : 100,
    "like" : []
}
```

## $where查询

where查询可以执行任意JavaScript语句作为查询的一部分。如果return为真，就返回这条数据，否则就不返回

```shell
db.test.find({"$where":function(){
    return this.name === "小游"
}})
/* 1 */
{
    "_id" : ObjectId("609bb9f16ac4daf1370a10c6"),
    "name" : "小游",
    "age" : 20,
    "like" : [ 
        "写代码", 
        "看番"
    ]
}
```

当然我们也可以使用一个字符串来指定where查询

```shell
db.test.find({"$where":"this.name === '小游'"})
```

## 游标

数据库会使用游标来返回find的执行结果，我们可以对这个cursor对象进行遍历操作

```shell
var cursor=db.test.find({})
cursor.forEach(function(x){
    print(x.name)
})
小游
张三
# 也可以这样进行操作，返回的记过都是一样的
var cursor=db.test.find({})
while(cursor.hasNext()){
    print(cursor.next().name);
}
```

### limit，skip，sort

最常用的查询选项就是限制返回结果的数量,忽略一定数量的结果并排序。所有这些选项一定要在查询被派发到服务器之前添加，比如我们只想返回一个结果





